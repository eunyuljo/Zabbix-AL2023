<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
  <version>7.0</version>
  <template_groups>
    <template_group>
      <uuid>58557f26ce964f2b831fbdf11aa29860</uuid>
      <name>Templates/Megazone AWS Monitoring</name>
    </template_group>
  </template_groups>
  <templates>
    <template>
      <uuid>7a79f532e18b4b34a90811d7814308d2</uuid>
      <template>Template Megazone AWS ALB CloudWatch v2</template>
      <name>Template Megazone AWS ALB CloudWatch v2</name>
      <groups>
        <group>
          <name>Templates/Megazone AWS Monitoring</name>
        </group>
      </groups>
      <items>
        <!-- LoadBalancer Level Metrics -->
        <item>
          <uuid>9dde4638255f49f3a7bc2a261ccd5ce4</uuid>
          <name>AWS ALB Request Count (Total)</name>
          <type>EXTERNAL</type>
          <key>aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},RequestCount,Sum,"Name=LoadBalancer,Value={$ALB_NAME}",{$ROLE_ARN}]</key>
          <delay>1m</delay>
          <history>90d</history>
          <trends>365d</trends>
          <value_type>FLOAT</value_type>
          <units></units>
          <description>Total number of requests processed by ALB over IPv4 and IPv6</description>
        </item>
        <item>
          <uuid>4878255d86284670a5b4a74cc332fa13</uuid>
          <name>AWS ALB HTTP 4XX Errors (ALB)</name>
          <type>EXTERNAL</type>
          <key>aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},HTTPCode_ELB_4XX_Count,Sum,"Name=LoadBalancer,Value={$ALB_NAME}",{$ROLE_ARN}]</key>
          <delay>1m</delay>
          <history>90d</history>
          <trends>365d</trends>
          <value_type>FLOAT</value_type>
          <units></units>
          <description>Number of HTTP 4XX client error codes generated by the load balancer</description>
          <triggers>
            <trigger>
              <uuid>5d23e17e64c74c97ae803b56404fc801</uuid>
              <expression>last(/Template Megazone AWS ALB CloudWatch v2/aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},HTTPCode_ELB_4XX_Count,Sum,"Name=LoadBalancer,Value={$ALB_NAME}",{$ROLE_ARN}])&gt;{$ALB.HTTP4XX.ELB.THRESHOLD}</expression>
              <name>AWS ALB: High HTTP 4XX errors from ALB (over {$ALB.HTTP4XX.ELB.THRESHOLD})</name>
              <priority>WARNING</priority>
              <description>Number of HTTP 4XX errors from ALB is above threshold</description>
            </trigger>
          </triggers>
        </item>
        <item>
          <uuid>c76a4c5f0617496a955c9b6150401b82</uuid>
          <name>AWS ALB HTTP 5XX Errors (ALB)</name>
          <type>EXTERNAL</type>
          <key>aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},HTTPCode_ELB_5XX_Count,Sum,"Name=LoadBalancer,Value={$ALB_NAME}",{$ROLE_ARN}]</key>
          <delay>1m</delay>
          <history>90d</history>
          <trends>365d</trends>
          <value_type>FLOAT</value_type>
          <units></units>
          <description>Number of HTTP 5XX server error codes generated by the load balancer</description>
          <triggers>
            <trigger>
              <uuid>5ceb8b40ec254470a78e510517b62ddc</uuid>
              <expression>last(/Template Megazone AWS ALB CloudWatch v2/aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},HTTPCode_ELB_5XX_Count,Sum,"Name=LoadBalancer,Value={$ALB_NAME}",{$ROLE_ARN}])&gt;{$ALB.HTTP5XX.ELB.THRESHOLD}</expression>
              <name>AWS ALB: High HTTP 5XX errors from ALB (over {$ALB.HTTP5XX.ELB.THRESHOLD})</name>
              <priority>HIGH</priority>
              <description>Number of HTTP 5XX errors from ALB is above threshold</description>
            </trigger>
          </triggers>
        </item>
        <!-- TargetGroup Level Metrics -->
        <item>
          <uuid>466b0df566c141bea89aaed0286ddcd3</uuid>
          <name>AWS ALB HTTP 2XX Count (Targets)</name>
          <type>EXTERNAL</type>
          <key>aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},HTTPCode_Target_2XX_Count,Sum,"Name=LoadBalancer,Value={$ALB_NAME} Name=TargetGroup,Value={$TG_NAME}",{$ROLE_ARN}]</key>
          <delay>1m</delay>
          <history>90d</history>
          <trends>365d</trends>
          <value_type>FLOAT</value_type>
          <units></units>
          <description>Number of HTTP 2XX response codes generated by targets</description>
        </item>
        <item>
          <uuid>e7ad3a676abc4efa83e1d89dcd9ccff4</uuid>
          <name>AWS ALB HTTP 4XX Count (Targets)</name>
          <type>EXTERNAL</type>
          <key>aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},HTTPCode_Target_4XX_Count,Sum,"Name=LoadBalancer,Value={$ALB_NAME} Name=TargetGroup,Value={$TG_NAME}",{$ROLE_ARN}]</key>
          <delay>1m</delay>
          <history>90d</history>
          <trends>365d</trends>
          <value_type>FLOAT</value_type>
          <units></units>
          <description>Number of HTTP 4XX response codes generated by targets</description>
        </item>
        <item>
          <uuid>5f3edbfaf52e45ae9082d9bd7c1e30c0</uuid>
          <name>AWS ALB HTTP 5XX Count (Targets)</name>
          <type>EXTERNAL</type>
          <key>aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},HTTPCode_Target_5XX_Count,Sum,"Name=LoadBalancer,Value={$ALB_NAME} Name=TargetGroup,Value={$TG_NAME}",{$ROLE_ARN}]</key>
          <delay>1m</delay>
          <history>90d</history>
          <trends>365d</trends>
          <value_type>FLOAT</value_type>
          <units></units>
          <description>Number of HTTP 5XX response codes generated by targets</description>
          <triggers>
            <trigger>
              <uuid>4f0632947142477f9fcc848dfe19f9a7</uuid>
              <expression>last(/Template Megazone AWS ALB CloudWatch v2/aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},HTTPCode_Target_5XX_Count,Sum,"Name=LoadBalancer,Value={$ALB_NAME} Name=TargetGroup,Value={$TG_NAME}",{$ROLE_ARN}])&gt;{$ALB.HTTP5XX.TARGET.THRESHOLD}</expression>
              <name>AWS ALB: High HTTP 5XX errors from targets (over {$ALB.HTTP5XX.TARGET.THRESHOLD})</name>
              <priority>WARNING</priority>
              <description>Number of HTTP 5XX errors from targets is above threshold</description>
            </trigger>
          </triggers>
        </item>
        <item>
          <uuid>1bd8a9e62d1b4b08aa3d2e073f5c674d</uuid>
          <name>AWS ALB Target Response Time</name>
          <type>EXTERNAL</type>
          <key>aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},TargetResponseTime,{$STATISTIC},"Name=LoadBalancer,Value={$ALB_NAME} Name=TargetGroup,Value={$TG_NAME}",{$ROLE_ARN}]</key>
          <delay>1m</delay>
          <history>90d</history>
          <trends>365d</trends>
          <value_type>FLOAT</value_type>
          <units>s</units>
          <description>Time elapsed, in seconds, after the request leaves the load balancer until a response from the target is received</description>
          <triggers>
            <trigger>
              <uuid>c4b7b2df157f4c8ba2a207347f60af9e</uuid>
              <expression>last(/Template Megazone AWS ALB CloudWatch v2/aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},TargetResponseTime,{$STATISTIC},"Name=LoadBalancer,Value={$ALB_NAME} Name=TargetGroup,Value={$TG_NAME}",{$ROLE_ARN}])&gt;{$ALB.RESPONSE.TIME.THRESHOLD}</expression>
              <name>AWS ALB: High target response time (over {$ALB.RESPONSE.TIME.THRESHOLD}s)</name>
              <priority>WARNING</priority>
              <description>Target response time is above threshold</description>
            </trigger>
          </triggers>
        </item>
        <item>
          <uuid>0500b330aa1146b69107cc36b49d14d2</uuid>
          <name>AWS ALB Healthy Host Count</name>
          <type>EXTERNAL</type>
          <key>aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},HealthyHostCount,{$STATISTIC},"Name=LoadBalancer,Value={$ALB_NAME} Name=TargetGroup,Value={$TG_NAME}",{$ROLE_ARN}]</key>
          <delay>1m</delay>
          <history>90d</history>
          <trends>365d</trends>
          <value_type>FLOAT</value_type>
          <units></units>
          <description>Number of targets that are considered healthy in the target group</description>
          <triggers>
            <trigger>
              <uuid>30b3bb204ab14e1dba5dacdd48674745</uuid>
              <expression>last(/Template Megazone AWS ALB CloudWatch v2/aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},HealthyHostCount,{$STATISTIC},"Name=LoadBalancer,Value={$ALB_NAME} Name=TargetGroup,Value={$TG_NAME}",{$ROLE_ARN}])&lt;{$ALB.HEALTHY.MIN.THRESHOLD}</expression>
              <name>AWS ALB: Low healthy host count (less than {$ALB.HEALTHY.MIN.THRESHOLD})</name>
              <priority>HIGH</priority>
              <description>Number of healthy hosts is below minimum threshold</description>
            </trigger>
          </triggers>
        </item>
        <item>
          <uuid>e7e66443befa4758988acb5b74d0df0a</uuid>
          <name>AWS ALB Unhealthy Host Count</name>
          <type>EXTERNAL</type>
          <key>aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},UnHealthyHostCount,{$STATISTIC},"Name=LoadBalancer,Value={$ALB_NAME} Name=TargetGroup,Value={$TG_NAME}",{$ROLE_ARN}]</key>
          <delay>1m</delay>
          <history>90d</history>
          <trends>365d</trends>
          <value_type>FLOAT</value_type>
          <units></units>
          <description>Number of targets that are considered unhealthy in the target group</description>
          <triggers>
            <trigger>
              <uuid>0a426989f0774ee9a4ea7d5aac141be6</uuid>
              <expression>last(/Template Megazone AWS ALB CloudWatch v2/aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},UnHealthyHostCount,{$STATISTIC},"Name=LoadBalancer,Value={$ALB_NAME} Name=TargetGroup,Value={$TG_NAME}",{$ROLE_ARN}])&gt;{$ALB.UNHEALTHY.MAX.THRESHOLD}</expression>
              <name>AWS ALB: High unhealthy host count (over {$ALB.UNHEALTHY.MAX.THRESHOLD})</name>
              <priority>WARNING</priority>
              <description>Number of unhealthy hosts is above maximum threshold</description>
            </trigger>
          </triggers>
        </item>
        <item>
          <uuid>6c4573b8b98141b98b3db49b097c8de2</uuid>
          <name>AWS ALB Request Count Per Target</name>
          <type>EXTERNAL</type>
          <key>aws-cloudwatch-metric[{$ACCOUNT_ID},{$REGION},{$NAMESPACE},RequestCountPerTarget,Sum,"Name=LoadBalancer,Value={$ALB_NAME} Name=TargetGroup,Value={$TG_NAME}",{$ROLE_ARN}]</key>
          <delay>1m</delay>
          <history>90d</history>
          <trends>365d</trends>
          <value_type>FLOAT</value_type>
          <units></units>
          <description>Average number of requests received by each target in the target group</description>
        </item>
      </items>
      <macros>
        <macro>
          <macro>{$ACCOUNT_ID}</macro>
          <value>123456789012</value>
          <description>AWS Account ID for CloudWatch access</description>
        </macro>
        <macro>
          <macro>{$ALB_NAME}</macro>
          <value>app/my-alb-name/1234567890123456</value>
          <description>ALB LoadBalancer name</description>
        </macro>
        <macro>
          <macro>{$TG_NAME}</macro>
          <value>targetgroup/my-target-group/1234567890123456</value>
          <description>ALB TargetGroup name</description>
        </macro>
        <macro>
          <macro>{$NAMESPACE}</macro>
          <value>AWS/ApplicationELB</value>
          <description>CloudWatch namespace for Application Load Balancer</description>
        </macro>
        <macro>
          <macro>{$REGION}</macro>
          <value>ap-northeast-2</value>
          <description>AWS Region where the ALB is located</description>
        </macro>
        <macro>
          <macro>{$ROLE_ARN}</macro>
          <value>arn:aws:iam::123456789012:role/ZabbixMonitoringRole</value>
          <description>IAM Role ARN for CloudWatch access</description>
        </macro>
        <macro>
          <macro>{$STATISTIC}</macro>
          <value>Average</value>
          <description>CloudWatch statistic type</description>
        </macro>
        <macro>
          <macro>{$ALB.HEALTHY.MIN.THRESHOLD}</macro>
          <value>1</value>
          <description>Minimum number of healthy hosts threshold</description>
        </macro>
        <macro>
          <macro>{$ALB.UNHEALTHY.MAX.THRESHOLD}</macro>
          <value>0</value>
          <description>Maximum number of unhealthy hosts threshold</description>
        </macro>
        <macro>
          <macro>{$ALB.RESPONSE.TIME.THRESHOLD}</macro>
          <value>3</value>
          <description>Target response time threshold in seconds</description>
        </macro>
        <macro>
          <macro>{$ALB.HTTP4XX.ELB.THRESHOLD}</macro>
          <value>50</value>
          <description>HTTP 4XX error count threshold from ALB</description>
        </macro>
        <macro>
          <macro>{$ALB.HTTP5XX.ELB.THRESHOLD}</macro>
          <value>5</value>
          <description>HTTP 5XX error count threshold from ALB</description>
        </macro>
        <macro>
          <macro>{$ALB.HTTP5XX.TARGET.THRESHOLD}</macro>
          <value>10</value>
          <description>HTTP 5XX error count threshold from targets</description>
        </macro>
      </macros>
    </template>
  </templates>
</zabbix_export>